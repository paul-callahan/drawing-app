var q=Object.defineProperty;var U=(t,e,r)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var B=(t,e,r)=>U(t,typeof e!="symbol"?e+"":e,r);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function r(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=r(s);fetch(s.href,o)}})();const f=1024;class j{constructor(){B(this,"tiles",new Map)}tileKey(e,r){return`${e},${r}`}getTile(e,r){const i=this.tileKey(e,r);if(!this.tiles.has(i)){const s=document.createElement("canvas");s.width=f,s.height=f,this.tiles.set(i,s)}return this.tiles.get(i)}getTileCtx(e,r){return this.getTile(e,r).getContext("2d")}drawVisibleTiles(e,r,i,s,o){e.clearRect(0,0,s,o);const u=Math.floor(r/f),a=Math.floor(i/f),v=Math.floor((r+s-1)/f),m=Math.floor((i+o-1)/f);for(let h=a;h<=m;h++)for(let d=u;d<=v;d++){const c=this.tiles.get(this.tileKey(d,h));if(c){const l=d*f-r,g=h*f-i;e.drawImage(c,l,g)}}}clearAll(){this.tiles.clear()}}const p=document.getElementById("drawing-canvas"),N=p.getContext("2d"),L=new j,n={isDrawing:!1,lastX:0,lastY:0,pressure:0,offsetX:5e3-p.width/2,offsetY:5e3-p.height/2,brushSize:5,brushColor:"#000000",pressureSensitivity:!0,currentTool:"pen"};function w(){L.drawVisibleTiles(N,n.offsetX,n.offsetY,p.width,p.height)}function P(){L.clearAll(),w()}function W(t){const e=p.getBoundingClientRect(),r="touches"in t?t.touches[0].clientX:t.clientX,i="touches"in t?t.touches[0].clientY:t.clientY;return{x:r-e.left,y:i-e.top}}function $(t){const e=W(t);return{x:e.x+n.offsetX,y:e.y+n.offsetY}}function z(t){return t.pressure!==void 0?t.pressure:.5}function F(){const t=document.createElement("canvas");t.width=p.width,t.height=p.height;const e=t.getContext("2d");return L.drawVisibleTiles(e,n.offsetX,n.offsetY,p.width,p.height),t.toDataURL("image/png")}function J(t){t.preventDefault();const e=40;n.offsetX+=t.deltaX*e/100,n.offsetY+=t.deltaY*e/100,n.offsetX=Math.max(0,Math.min(n.offsetX,1e4-p.width)),n.offsetY=Math.max(0,Math.min(n.offsetY,1e4-p.height)),w()}function M(t){n.currentTool=t,w()}function Z(t){n.brushSize=t}function G(t){n.brushColor=t}function Q(t){n.pressureSensitivity=t}const E=document.getElementById("pen-tool"),b=document.getElementById("eraser-tool"),C=document.getElementById("brush-size"),H=document.getElementById("brush-size-value"),D=document.getElementById("brush-color"),X=document.getElementById("pressure-sensitivity"),ee=document.getElementById("clear-canvas"),te=document.getElementById("save-image"),ne=document.getElementById("coordinates"),Y=document.getElementById("pressure-value"),se=document.getElementById("tool-info"),S=document.getElementById("pressure-indicator"),re=S.querySelector(".pressure-bar");function oe(t,e){ne.textContent=`X: ${Math.round(t)}, Y: ${Math.round(e)}`}function k(t,e){e?(S.classList.add("visible"),re.style.height=`${t*100}%`,Y.textContent=`Pressure: ${Math.round(t*100)}%`):(S.classList.remove("visible"),Y.textContent="Pressure: 0%")}function x(t){se.textContent=t}const ie="modulepreload",ae=function(t){return"/drawing-app/"+t},_={},ce=function(e,r,i){let s=Promise.resolve();if(r&&r.length>0){let u=function(m){return Promise.all(m.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),v=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=u(r.map(m=>{if(m=ae(m),m in _)return;_[m]=!0;const h=m.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${d}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":ie,h||(c.as="script"),c.crossOrigin="",c.href=m,v&&c.setAttribute("nonce",v),document.head.appendChild(c),h)return new Promise((l,g)=>{c.addEventListener("load",l),c.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(u){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=u,window.dispatchEvent(a),!a.defaultPrevented)throw u}return s.then(u=>{for(const a of u||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},le=!!window.__TAURI__;async function ue(t){if(le)try{const{invoke:e}=await ce(async()=>{const{invoke:r}=await import("./core-DV6XEvTN.js");return{invoke:r}},[]);return e("save_image",{dataUrl:t})}catch{return console.warn("Tauri API not available, falling back to web download"),K(t)}else return K(t)}function K(t){const e=document.createElement("a");return e.href=t,e.download=`drawing_${Date.now()}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e),Promise.resolve("Image downloaded")}function T(t){n.isDrawing=!0;const e=$(t);n.lastX=e.x,n.lastY=e.y,"pressure"in t&&(n.pressure=z(t),k(n.pressure,n.pressureSensitivity))}function I(t){if(!n.isDrawing)return;const e=$(t),r=e.x,i=e.y;let s=.5;"pressure"in t&&(s=z(t),n.pressure=s,k(s,n.pressureSensitivity));let o=n.brushSize;n.pressureSensitivity&&s>0&&(o=n.brushSize*s),de(n.lastX,n.lastY,r,i,o,n.currentTool,n.brushColor),n.lastX=r,n.lastY=i;const u=r-n.offsetX,a=i-n.offsetY;oe(u,a),w()}function y(){n.isDrawing=!1,k(0,!1)}function de(t,e,r,i,s,o,u){const a=Math.floor(Math.min(t,r)/f),v=Math.floor(Math.max(t,r)/f),m=Math.floor(Math.min(e,i)/f),h=Math.floor(Math.max(e,i)/f);for(let d=m;d<=h;d++)for(let c=a;c<=v;c++){const l=L.getTileCtx(c,d);l.save(),l.lineCap="round",l.lineJoin="round",l.lineWidth=Math.max(1,s),o==="eraser"?(l.globalCompositeOperation="destination-out",l.strokeStyle="rgba(0,0,0,1)"):(l.globalCompositeOperation="source-over",l.strokeStyle=u),l.beginPath();const g=t-c*f,A=e-d*f,V=r-c*f,R=i-d*f;l.moveTo(g,A),l.lineTo(V,R),l.stroke(),l.restore()}}async function O(){try{const t=F(),e=await ue(t);console.log("Image saved:",e)}catch(t){console.error("Error saving image:",t)}}function fe(){const t=document.getElementById("drawing-canvas");t.addEventListener("mousedown",T),t.addEventListener("mousemove",I),t.addEventListener("mouseup",y),t.addEventListener("mouseout",y),t.addEventListener("touchstart",e=>{e.preventDefault(),T(e)}),t.addEventListener("touchmove",e=>{e.preventDefault(),I(e)}),t.addEventListener("touchend",y),t.addEventListener("pointerdown",e=>{e.preventDefault(),T(e)}),t.addEventListener("pointermove",e=>{e.preventDefault(),I(e)}),t.addEventListener("pointerup",y),t.addEventListener("pointerleave",y),t.addEventListener("wheel",J,{passive:!1}),E.addEventListener("click",()=>{M("pen"),E.classList.add("active"),b.classList.remove("active"),x("Pen Tool")}),b.addEventListener("click",()=>{M("eraser"),b.classList.add("active"),E.classList.remove("active"),x("Eraser Tool")}),C.addEventListener("input",()=>{Z(parseInt(C.value)),H.textContent=C.value}),D.addEventListener("change",()=>{G(D.value)}),X.addEventListener("change",()=>{Q(X.checked)}),ee.addEventListener("click",P),te.addEventListener("click",O),document.addEventListener("keydown",e=>{switch(e.key){case"b":case"B":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),E.click());break;case"e":case"E":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),b.click());break;case"Delete":case"Backspace":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),P());break;case"s":case"S":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),O());break}})}function me(){w(),fe(),x("Pen Tool"),console.log("Drawing app initialized with tiled infinite canvas.")}window.addEventListener("DOMContentLoaded",me);
