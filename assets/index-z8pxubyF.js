var R=Object.defineProperty;var U=(t,e,o)=>e in t?R(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o;var k=(t,e,o)=>U(t,typeof e!="symbol"?e+"":e,o);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();const f=1024;class q{constructor(){k(this,"tiles",new Map)}tileKey(e,o){return`${e},${o}`}getTile(e,o){const i=this.tileKey(e,o);if(!this.tiles.has(i)){const s=document.createElement("canvas");s.width=f,s.height=f,this.tiles.set(i,s)}return this.tiles.get(i)}getTileCtx(e,o){return this.getTile(e,o).getContext("2d")}drawVisibleTiles(e,o,i,s,r){e.clearRect(0,0,s,r);const u=Math.floor(o/f),a=Math.floor(i/f),v=Math.floor((o+s-1)/f),m=Math.floor((i+r-1)/f);for(let h=a;h<=m;h++)for(let d=u;d<=v;d++){const c=this.tiles.get(this.tileKey(d,h));if(c){const l=d*f-o,g=h*f-i;e.drawImage(c,l,g)}}}clearAll(){this.tiles.clear()}}const p=document.getElementById("drawing-canvas"),j=p.getContext("2d"),b=new q,n={isDrawing:!1,lastX:0,lastY:0,pressure:0,offsetX:5e3-p.width/2,offsetY:5e3-p.height/2,brushSize:5,brushColor:"#000000",pressureSensitivity:!0,currentTool:"pen"};function E(){b.drawVisibleTiles(j,n.offsetX,n.offsetY,p.width,p.height)}function M(){b.clearAll(),E()}function N(t){const e=p.getBoundingClientRect(),o="touches"in t?t.touches[0].clientX:t.clientX,i="touches"in t?t.touches[0].clientY:t.clientY;return{x:o-e.left,y:i-e.top}}function O(t){const e=N(t);return{x:e.x+n.offsetX,y:e.y+n.offsetY}}function $(t){return t.pressure!==void 0?t.pressure:.5}function W(){const t=document.createElement("canvas");t.width=p.width,t.height=p.height;const e=t.getContext("2d");return b.drawVisibleTiles(e,n.offsetX,n.offsetY,p.width,p.height),t.toDataURL("image/png")}function F(t){t.preventDefault();const e=40;n.offsetX+=t.deltaX*e/100,n.offsetY+=t.deltaY*e/100,n.offsetX=Math.max(0,Math.min(n.offsetX,1e4-p.width)),n.offsetY=Math.max(0,Math.min(n.offsetY,1e4-p.height)),E()}function P(t){n.currentTool=t,E()}function J(t){n.brushSize=t}function Z(t){n.brushColor=t}function G(t){n.pressureSensitivity=t}const w=document.getElementById("pen-tool"),L=document.getElementById("eraser-tool"),C=document.getElementById("brush-size"),Q=document.getElementById("brush-size-value"),D=document.getElementById("brush-color"),X=document.getElementById("pressure-sensitivity"),H=document.getElementById("clear-canvas"),ee=document.getElementById("save-image"),te=document.getElementById("coordinates"),Y=document.getElementById("pressure-value"),ne=document.getElementById("tool-info"),I=document.getElementById("pressure-indicator"),se=I.querySelector(".pressure-bar");function oe(t,e){te.textContent=`X: ${Math.round(t)}, Y: ${Math.round(e)}`}function B(t,e){e?(I.classList.add("visible"),se.style.height=`${t*100}%`,Y.textContent=`Pressure: ${Math.round(t*100)}%`):(I.classList.remove("visible"),Y.textContent="Pressure: 0%")}function x(t){ne.textContent=t}const re="modulepreload",ie=function(t){return"/"+t},_={},ae=function(e,o,i){let s=Promise.resolve();if(o&&o.length>0){let u=function(m){return Promise.all(m.map(h=>Promise.resolve(h).then(d=>({status:"fulfilled",value:d}),d=>({status:"rejected",reason:d}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),v=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=u(o.map(m=>{if(m=ie(m),m in _)return;_[m]=!0;const h=m.endsWith(".css"),d=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${d}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":re,h||(c.as="script"),c.crossOrigin="",c.href=m,v&&c.setAttribute("nonce",v),document.head.appendChild(c),h)return new Promise((l,g)=>{c.addEventListener("load",l),c.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${m}`)))})}))}function r(u){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=u,window.dispatchEvent(a),!a.defaultPrevented)throw u}return s.then(u=>{for(const a of u||[])a.status==="rejected"&&r(a.reason);return e().catch(r)})},ce=!!window.__TAURI__;async function le(t){if(ce){const{invoke:e}=await ae(async()=>{const{invoke:o}=await import("./core-DV6XEvTN.js");return{invoke:o}},[]);return e("save_image",{dataUrl:t})}else{const e=document.createElement("a");return e.href=t,e.download=`drawing_${Date.now()}.png`,document.body.appendChild(e),e.click(),document.body.removeChild(e),Promise.resolve("Image downloaded")}}function T(t){n.isDrawing=!0;const e=O(t);n.lastX=e.x,n.lastY=e.y,"pressure"in t&&(n.pressure=$(t),B(n.pressure,n.pressureSensitivity))}function S(t){if(!n.isDrawing)return;const e=O(t),o=e.x,i=e.y;let s=.5;"pressure"in t&&(s=$(t),n.pressure=s,B(s,n.pressureSensitivity));let r=n.brushSize;n.pressureSensitivity&&s>0&&(r=n.brushSize*s),ue(n.lastX,n.lastY,o,i,r,n.currentTool,n.brushColor),n.lastX=o,n.lastY=i;const u=o-n.offsetX,a=i-n.offsetY;oe(u,a),E()}function y(){n.isDrawing=!1,B(0,!1)}function ue(t,e,o,i,s,r,u){const a=Math.floor(Math.min(t,o)/f),v=Math.floor(Math.max(t,o)/f),m=Math.floor(Math.min(e,i)/f),h=Math.floor(Math.max(e,i)/f);for(let d=m;d<=h;d++)for(let c=a;c<=v;c++){const l=b.getTileCtx(c,d);l.save(),l.lineCap="round",l.lineJoin="round",l.lineWidth=Math.max(1,s),r==="eraser"?(l.globalCompositeOperation="destination-out",l.strokeStyle="rgba(0,0,0,1)"):(l.globalCompositeOperation="source-over",l.strokeStyle=u),l.beginPath();const g=t-c*f,z=e-d*f,V=o-c*f,A=i-d*f;l.moveTo(g,z),l.lineTo(V,A),l.stroke(),l.restore()}}async function K(){try{const t=W(),e=await le(t);console.log("Image saved:",e)}catch(t){console.error("Error saving image:",t)}}function de(){const t=document.getElementById("drawing-canvas");t.addEventListener("mousedown",T),t.addEventListener("mousemove",S),t.addEventListener("mouseup",y),t.addEventListener("mouseout",y),t.addEventListener("touchstart",e=>{e.preventDefault(),T(e)}),t.addEventListener("touchmove",e=>{e.preventDefault(),S(e)}),t.addEventListener("touchend",y),t.addEventListener("pointerdown",e=>{e.preventDefault(),T(e)}),t.addEventListener("pointermove",e=>{e.preventDefault(),S(e)}),t.addEventListener("pointerup",y),t.addEventListener("pointerleave",y),t.addEventListener("wheel",F,{passive:!1}),w.addEventListener("click",()=>{P("pen"),w.classList.add("active"),L.classList.remove("active"),x("Pen Tool")}),L.addEventListener("click",()=>{P("eraser"),L.classList.add("active"),w.classList.remove("active"),x("Eraser Tool")}),C.addEventListener("input",()=>{J(parseInt(C.value)),Q.textContent=C.value}),D.addEventListener("change",()=>{Z(D.value)}),X.addEventListener("change",()=>{G(X.checked)}),H.addEventListener("click",M),ee.addEventListener("click",K),document.addEventListener("keydown",e=>{switch(e.key){case"b":case"B":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),w.click());break;case"e":case"E":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),L.click());break;case"Delete":case"Backspace":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),M());break;case"s":case"S":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),K());break}})}function fe(){E(),de(),x("Pen Tool"),console.log("Drawing app initialized with tiled infinite canvas.")}window.addEventListener("DOMContentLoaded",fe);
